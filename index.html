<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Panel de Control MQA - Sistema Integral de Monitoreo Marino">
    <meta name="theme-color" content="#1e40af">
    <title>üì° Panel MQA - Sistema de Monitoreo Marino</title>
    
    <!-- Content Security Policy para permitir fuentes externas -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: https:; font-src 'self' data: https:; img-src 'self' data: https:;">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
    <link rel="apple-touch-icon" href="icon-192.png">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                fontFamily: {
                    'sans': ['system-ui', 'Arial', 'sans-serif']
                }
            }
        }
    </script>
    
    <style>
        /* Animaciones personalizadas optimizadas */
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
        }
        
        @keyframes float-up {
            0% { transform: translateY(0px); opacity: 1; }
            100% { transform: translateY(-30px); opacity: 0; }
        }
        
        @keyframes wiggle {
            0%, 100% { transform: rotate(-2deg); }
            50% { transform: rotate(2deg); }
        }

        @keyframes sound-wave {
            0%, 100% { height: 8px; }
            50% { height: 20px; }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse-glow {
            0%, 100% { 
                opacity: 1;
                box-shadow: 0 0 15px rgba(6, 182, 212, 0.3);
            }
            50% { 
                opacity: 0.8;
                box-shadow: 0 0 25px rgba(6, 182, 212, 0.5);
            }
        }

        @keyframes gentle-bounce {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-3px); }
        }

        @keyframes soft-pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.02); opacity: 0.9; }
        }

        /* Efectos est√°ticos para reemplazar animaciones */
        .static-glow {
            box-shadow: 0 0 15px rgba(6, 182, 212, 0.4);
        }
        
        .static-highlight {
            background: linear-gradient(135deg, rgba(6, 182, 212, 0.1), rgba(59, 130, 246, 0.1));
        }
        
        .static-emphasis {
            transform: scale(1.02);
            opacity: 0.95;
        }

        .animate-float {
            /* Animaci√≥n desactivada para evitar temblor */
        }

        .animate-float-up {
            /* Animaci√≥n desactivada para evitar temblor */
        }

        .animate-wiggle {
            /* Animaci√≥n desactivada para evitar temblor */
        }

        .animate-sound-wave {
            /* Animaci√≥n desactivada para evitar temblor */
        }

        .animate-slide-up {
            animation: slideUp 0.3s ease-out;
        }

        .animate-pulse-glow {
            /* Animaci√≥n desactivada para evitar temblor */
        }

        .animate-gentle-bounce {
            /* Animaci√≥n desactivada para evitar temblor */
        }

        .animate-soft-pulse {
            /* Animaci√≥n desactivada para evitar temblor */
        }

        /* Scrollbar personalizado */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(6, 182, 212, 0.5);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(6, 182, 212, 0.8);
        }

        /* Responsive design */
        @media (max-width: 640px) {
            .text-8xl { font-size: 4rem; }
            .max-w-6xl { max-width: 100%; }
        }
    </style>
</head>
<body>
    <div id="app"></div>

    <!-- React desde CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <script type="module">
        const { useState, useEffect, useRef, createElement: h } = React;

        // ==================== BASE DE CONOCIMIENTO COMPLETA ====================
        const knowledgeBase = {
            'pantalla principal': {
                response: 'üñ•Ô∏è La pantalla principal es tu centro de control. Muestra 8 par√°metros vitales:\n\nüå°Ô∏è Temperatura agua motor (75-90¬∞C normal)\nüõ¢Ô∏è Presi√≥n aceite (40-60 psi normal)\nüå°Ô∏è Temperatura aceite (80-120¬∞C normal)\n‚ö° Voltaje bater√≠a (12V/24V seg√∫n sistema)\n‚è±Ô∏è Hor√≥metro (horas totales de uso)\nüîÑ RPM (revoluciones por minuto)\nüö§ Velocidad de navegaci√≥n\nüìä N√∫mero de logs registrados\n\nTodos los datos se actualizan en tiempo real. ¬øNecesitas informaci√≥n sobre alg√∫n par√°metro espec√≠fico?',
                keywords: ['principal', 'inicio', 'dashboard', 'pantalla', 'home', 'menu'],
                images: ['assets/equipos/pantallas/pantalla.jpg']
            },
            'iconos': {
                response: 'üéØ Los √≠conos son tus indicadores visuales instant√°neos:\n\nüö® ALARMA: Blanco=OK | Rojo parpadeante=CR√çTICO\nüì° GPS: Rojo=sin se√±al | Blanco=estable | Parpadeante=conectando\nüîá SILENCIO: Activa/desactiva alarma sonora\n‚öôÔ∏è CONFIG: Acceso a configuraci√≥n\nüì± BLUETOOTH: Rojo=off | Parpadeante=emparejando | Blanco=conectado\nüì∂ WI-FI: Estado de conexi√≥n a internet\nüõ∞Ô∏è SAT√âLITES: Recepci√≥n GPS activa\n‚òÅÔ∏è NUBE: Transmisi√≥n de datos\n\n¬øQu√© √≠cono necesitas entender mejor?',
                keywords: ['icono', '√≠cono', 's√≠mbolo', 'indicador', 'estado', 'se√±al']
            },
            'gps': {
                response: 'üìç El m√≥dulo GPS es fundamental para navegaci√≥n precisa:\n\nüìä DATOS QUE MUESTRA:\n‚Ä¢ Latitud y Longitud (coordenadas exactas)\n‚Ä¢ Altitud sobre nivel del mar\n‚Ä¢ Curso/rumbo de navegaci√≥n\n‚Ä¢ Velocidad actual (nudos o km/h)\n‚Ä¢ N√∫mero de sat√©lites (m√≠nimo 4 recomendado)\n‚Ä¢ Fecha y hora GPS vs RTC del panel\n\n‚öôÔ∏è FUNCI√ìN CLAVE:\nBot√≥n "Actualizar RTC" sincroniza el reloj interno con GPS para registros precisos.\n\nüîß Si √≠cono GPS est√° rojo: verifica antena, ub√≠cate en zona despejada, espera 2-3 minutos.\n\n¬øProblemas con la se√±al GPS?',
                keywords: ['gps', 'ubicaci√≥n', 'posici√≥n', 'coordenadas', 'sat√©lite', 'navegaci√≥n', 'latitud', 'longitud'],
                images: ['assets/equipos/gps/FT-6.png']
            },
            'alarma': {
                response: '‚ö†Ô∏è SISTEMA DE ALARMAS - PROTOCOLO DE EMERGENCIA:\n\nüî¥ ALARMAS CR√çTICAS:\n\n1Ô∏è‚É£ SOBRECALENTAMIENTO:\n   ‚Ä¢ Acci√≥n: Reducir carga inmediatamente\n   ‚Ä¢ Verificar sistema refrigeraci√≥n\n   ‚Ä¢ Si persiste: DETENER MOTOR\n\n2Ô∏è‚É£ BAJA PRESI√ìN ACEITE:\n   ‚Ä¢ Acci√≥n: Detener inmediatamente\n   ‚Ä¢ Verificar nivel aceite\n   ‚Ä¢ Inspeccionar fugas\n\n3Ô∏è‚É£ BAJO VOLTAJE:\n   ‚Ä¢ Verificar bater√≠a\n   ‚Ä¢ Inspeccionar alternador\n   ‚Ä¢ Reducir consumo el√©ctrico\n\nüü† ALARMAS PREVENTIVAS:\n‚Ä¢ Alto consumo combustible\n‚Ä¢ Baja se√±al GPS\n‚Ä¢ P√©rdida conexi√≥n Wi-Fi\n\nüîä GESTI√ìN:\n‚Ä¢ Silenciar: Bot√≥n üîá\n‚Ä¢ Reconocer: Resolver causa ra√≠z\n‚Ä¢ Registro: Logger guarda eventos\n\n¬øQu√© alarma est√°s experimentando?',
                keywords: ['alarma', 'alerta', 'emergencia', 'problema', 'falla', 'rojo', 'parpadeante', 'cr√≠tico'],
                images: ['assets/equipos/alarma/alr.jpg']
            },
                'configuraci√≥n equipos': {
                    response: '‚öôÔ∏è CONFIGURACI√ìN DE EQUIPOS - PANEL MQA:\n\nüéØ EQUIPOS DISPONIBLES:\n\nüì± PANEL PRINCIPAL:\n‚Ä¢ Pantalla t√°ctil con 8 par√°metros vitales\n‚Ä¢ √çconos de estado en tiempo real\n‚Ä¢ Sistema de alarmas integrado\n\nüìç M√ìDULO GPS/GNSS:\n‚Ä¢ Coordenadas precisas (Lat/Long)\n‚Ä¢ Sincronizaci√≥n horaria RTC\n‚Ä¢ Datos de navegaci√≥n completos\n\nüìä SISTEMA LOGGER:\n‚Ä¢ Registro autom√°tico de datos\n‚Ä¢ Intervalos configurables (1-60 seg)\n‚Ä¢ Almacenamiento local y nube\n\nüì± CONECTIVIDAD:\n‚Ä¢ Bluetooth para m√≥viles\n‚Ä¢ Wi-Fi para transmisi√≥n\n‚Ä¢ Configuraci√≥n de credenciales\n\nüéõÔ∏è COMBO-BOX (1-4):\n‚Ä¢ Selecci√≥n personalizada de sensores\n‚Ä¢ Temperaturas, presiones, flujos\n‚Ä¢ Configuraci√≥n flexible por usuario\n\n¬øQu√© equipo necesitas configurar?',
                    keywords: ['configuraci√≥n equipos', 'config equipos', 'equipos', 'configurar equipos', 'setup equipos'],
                    images: ['assets/equipos/configuracion/pantalla-config-general.jpg']
                },
            'logger': {
                response: 'üìä DATALOGGER - Sistema de Registro:\n\n‚öôÔ∏è CONFIGURACI√ìN:\n\nüìù Log/Seg (Intervalo):\n‚Ä¢ 1 seg: Diagn√≥stico intensivo\n‚Ä¢ 10 seg: ‚≠ê Operaci√≥n normal recomendada\n‚Ä¢ 30 seg: Navegaci√≥n prolongada\n‚Ä¢ 60 seg: Trayectos largos\n\nüÜî ID Panel:\nC√≥digo √∫nico de identificaci√≥n\nEsencial para distinguir en la nube\n\nüíæ CAPACIDAD:\nAlmacenamiento local + nube\nDatos protegidos sin conectividad\n\n¬øQu√© intervalo necesitas?',
                keywords: ['logger', 'registro', 'datos', 'log', 'grabaci√≥n', 'almacenamiento'],
                images: ['assets/equipos/logger/FT-7.png']
            },
            'bluetooth': {
                response: 'üì± CONFIGURACI√ìN BLUETOOTH:\n\nüîß PASOS:\n\n1Ô∏è‚É£ Ve a Config > Bluetooth\n2Ô∏è‚É£ Define Nombre BT (ej: Panel_MOA01)\n3Ô∏è‚É£ Contrase√±a (m√≠nimo 6 caracteres)\n4Ô∏è‚É£ Guardar cambios\n5Ô∏è‚É£ Emparejamiento:\n   ‚Ä¢ √çcono BT parpadea\n   ‚Ä¢ Busca en tu m√≥vil\n   ‚Ä¢ Selecciona el nombre\n   ‚Ä¢ Ingresa contrase√±a\n   ‚Ä¢ √çcono blanco = ‚úÖ VINCULADO\n\nüì≤ USO M√ìVIL:\nPermite control b√°sico y lectura de datos\n\n¬øDeseas cambiar nombre o contrase√±a BT?',
                keywords: ['bluetooth', 'bt', 'emparejamiento', 'conexi√≥n', 'm√≥vil', 'vincular'],
                images: ['assets/equipos/bluetooth/FT-8.png']
            },
            'configuraci√≥n': {
                response: '‚öôÔ∏è CONFIGURACI√ìN GENERAL:\n\nIncluye Wi-Fi, Bluetooth, GPS, Logger y selecci√≥n de sensores mediante Combo-Box.\n\nAccede con el √≠cono ‚öôÔ∏è desde la pantalla principal.',
                keywords: ['configuraci√≥n', 'ajustes', 'settings', 'config'],
                images: ['assets/equipos/configuracion/pantalla-config-general.jpg']
            },
            'wifi': {
                response: 'üì∂ CONEXI√ìN WI-FI:\n\nüåê PASOS:\n\n1Ô∏è‚É£ REQUISITOS:\n   ‚Ä¢ Router Wi-Fi activo\n   ‚Ä¢ SSID (nombre red)\n   ‚Ä¢ Contrase√±a\n   ‚Ä¢ Se√±al m√≠nima 2 barras\n\n2Ô∏è‚É£ CONFIGURAR:\n   ‚Ä¢ Config > Wi-Fi\n   ‚Ä¢ Ingresa SSID exacto\n   ‚Ä¢ Ingresa contrase√±a\n   ‚Ä¢ Guarda y verifica √≠cono\n\nüß™ PRUEBA:\n   ‚Ä¢ √çcono Wi-Fi blanco = conectado\n   ‚Ä¢ Nube blanca = sincronizaci√≥n habilitada\n\nüîß PROBLEMAS COMUNES:\n   ‚Ä¢ SSID mal escrito\n   ‚Ä¢ Contrase√±a incorrecta\n   ‚Ä¢ Se√±al d√©bil\n\n¬øQuieres configurar Wi-Fi ahora?',
                keywords: ['wifi', 'wi-fi', 'internet', 'red', 'conexi√≥n', 'ssid'],
                images: ['assets/equipos/configuracion/pantalla-config-general.jpg']
             },
            'combustible': {
                response: '‚õΩ GESTI√ìN DE COMBUSTIBLE:\n\nüìä MONITOREO:\nSensor de flujo mide consumo instant√°neo (L/h)\n\nüéØ CONFIGURACI√ìN:\n‚Ä¢ Combo-Box 4: "Consumo instant√°neo"\n‚Ä¢ Pantalla muestra L/h en tiempo real\n‚Ä¢ Logger registra hist√≥rico\n\nüìà OPTIMIZACI√ìN:\n\n1Ô∏è‚É£ AN√ÅLISIS:\n   ‚Ä¢ Revisa consumo a diferentes RPM\n   ‚Ä¢ Punto √≥ptimo: 1800-2200 RPM\n\n2Ô∏è‚É£ FACTORES:\n   ‚Ä¢ Velocidad navegaci√≥n\n   ‚Ä¢ Carga embarcaci√≥n\n   ‚Ä¢ Estado del mar\n   ‚Ä¢ Mantenimiento motor\n\nüí∞ IMPACTO:\nReducci√≥n 20% = Ahorro >$2,000 USD/a√±o\n\n¬øQuieres optimizar tu consumo?',
                keywords: ['combustible', 'consumo', 'gasolina', 'diesel', 'ahorro', 'litros']
            },
            'temperatura': {
                response: 'üå°Ô∏è MONITOREO DE TEMPERATURAS:\n\nüìä RANGOS NORMALES:\n\n1Ô∏è‚É£ AGUA DEL MOTOR:\n   ‚úÖ Normal: 75-90¬∞C\n   ‚ö†Ô∏è Alerta: 90-95¬∞C\n   üî¥ Cr√≠tico: >95¬∞C\n\n2Ô∏è‚É£ ACEITE DEL MOTOR:\n   ‚úÖ Normal: 80-120¬∞C\n   ‚ö†Ô∏è Alerta: 120-130¬∞C\n   üî¥ Cr√≠tico: >130¬∞C\n\n3Ô∏è‚É£ GASES DE ESCAPE:\n   ‚úÖ Normal: 300-450¬∞C\n   ‚ö†Ô∏è Alerta: 450-500¬∞C\n\nüîß FACTORES:\n‚Ä¢ Carga del motor\n‚Ä¢ Velocidad navegaci√≥n\n‚Ä¢ Temperatura ambiente\n‚Ä¢ Estado refrigeraci√≥n\n\nüí° PREVENCI√ìN:\nMonitorea tendencias, no solo valores puntuales\n\n¬øQu√© temperatura te preocupa?',
                keywords: ['temperatura', 'calor', 'sobrecalentamiento', 'grados', 'celsius']
            },
            'mantenimiento': {
                response: 'üîß MANTENIMIENTO PREDICTIVO:\n\nüìÖ CALENDARIO:\n\nüü¢ MENSUAL:\n   ‚Ä¢ Limpieza conectores\n   ‚Ä¢ Revisi√≥n Wi-Fi/BT\n   ‚Ä¢ Inspecci√≥n visual sensores\n\nüü° TRIMESTRAL:\n   ‚≠ê CALIBRACI√ìN OBLIGATORIA\n   ‚Ä¢ Sensores temperatura/presi√≥n\n   ‚Ä¢ Verificaci√≥n GPS\n   ‚Ä¢ Limpieza profunda\n\nüü† SEMESTRAL:\n   ‚Ä¢ Actualizaci√≥n firmware\n   ‚Ä¢ Revisi√≥n integral DAQ\n   ‚Ä¢ Test todos los sensores\n\nüî¥ ANUAL:\n   ‚Ä¢ Auditor√≠a completa\n   ‚Ä¢ Reemplazo componentes\n   ‚Ä¢ Certificaci√≥n t√©cnica\n\n‚ö†Ô∏è CORRECTIVO:\n‚Ä¢ Sensor fuera servicio: Reemplazo inmediato\n‚Ä¢ GPS sin se√±al: Verificar antena\n‚Ä¢ Panel congelado: Reinicio\n\n¬øNecesitas checklist detallado?',
                keywords: ['mantenimiento', 'calibraci√≥n', 'limpieza', 'reparaci√≥n', 'servicio']
            },
            'sensores': {
                response: 'üì° SISTEMA DE SENSORES:\n\nüî¨ TIPOS:\n\n1Ô∏è‚É£ TEMPERATURA (NTC):\n   ‚Ä¢ Precisi√≥n: ¬±0.5¬∞C\n   ‚Ä¢ Rango: -40¬∞C a +150¬∞C\n\n2Ô∏è‚É£ PRESI√ìN (Piezoresistivos):\n   ‚Ä¢ Precisi√≥n: ¬±2%\n   ‚Ä¢ Rango: 0-100 psi\n\n3Ô∏è‚É£ FLUJO COMBUSTIBLE:\n   ‚Ä¢ Precisi√≥n: ¬±2%\n   ‚Ä¢ Rango: 0-200 L/h\n\n4Ô∏è‚É£ RPM (Inductivo):\n   ‚Ä¢ Precisi√≥n: ¬±5 RPM\n\n5Ô∏è‚É£ GPS (GNSS):\n   ‚Ä¢ Precisi√≥n: ¬±2 metros\n   ‚Ä¢ Canales: 50+\n\nüîß MANTENIMIENTO:\n‚Ä¢ Calibraci√≥n trimestral obligatoria\n‚Ä¢ Solo sensores homologados\n‚Ä¢ Documentar intervenciones\n\n¬øProblemas con alg√∫n sensor?',
                keywords: ['sensor', 'sensores', 'medici√≥n', 'instrumentaci√≥n', 'calibraci√≥n']
            },
            'configuraci√≥n equipos': {
                response: 'üîß CONFIGURACI√ìN DE EQUIPOS:\n\nüìã COMBO-BOX DISPONIBLES:\n\nüîπ COMBO-BOX 1 (Temperaturas):\n   ‚Ä¢ Temp. agua de motor\n   ‚Ä¢ Temp. gases de escape\n   ‚Ä¢ Temp. aceite de caja\n   ‚Ä¢ Temp. aire de admisi√≥n\n   ‚Ä¢ Temp. descanso 01\n\nüîπ COMBO-BOX 2 (Presiones):\n   ‚Ä¢ Presi√≥n de aceite del motor\n   ‚Ä¢ Presi√≥n de admisi√≥n (turbo)\n   ‚Ä¢ Presi√≥n de aceite de caja\n\nüîπ COMBO-BOX 3 (M√°s Temperaturas):\n   ‚Ä¢ Temp. aceite de motor\n   ‚Ä¢ Temp. descanso 02-05\n\nüîπ COMBO-BOX 4 (Flujos):\n   ‚Ä¢ Consumo instant√°neo combustible\n   ‚Ä¢ Flujo de entrada\n   ‚Ä¢ Flujo de salida\n\n‚öôÔ∏è CONFIGURACI√ìN:\n1. Pulse Config en pantalla principal\n2. Seleccione par√°metros en cada Combo-Box\n3. Configure Wi-Fi (SSID/contrase√±a)\n4. Guarde cambios\n\n¬øNecesitas ayuda con alg√∫n Combo-Box espec√≠fico?',
                keywords: ['configuraci√≥n equipos', 'combo-box', 'combo box', 'equipos', 'configurar sensores', 'par√°metros'],
                images: ['assets/equipos/configuracion/CONFIG.jpg']
            },
            'combo-box': {
                response: 'üìä MEN√öS COMBO-BOX:\n\nüéõÔ∏è FUNCI√ìN:\nPermiten personalizar qu√© par√°metros se muestran en la pantalla principal.\n\nüìã DISTRIBUCI√ìN:\n\nüî∏ COMBO-BOX 1:\n   ‚Ä¢ Temp. agua de motor\n   ‚Ä¢ Temp. gases de escape\n   ‚Ä¢ Temp. aceite de caja\n   ‚Ä¢ Temp. aire de admisi√≥n\n   ‚Ä¢ Temp. descanso 01\n\nüî∏ COMBO-BOX 2:\n   ‚Ä¢ Presi√≥n aceite motor\n   ‚Ä¢ Presi√≥n admisi√≥n\n   ‚Ä¢ Presi√≥n aceite caja\n\nüî∏ COMBO-BOX 3:\n   ‚Ä¢ Temp. aceite motor\n   ‚Ä¢ Temp. descanso 02-05\n\nüî∏ COMBO-BOX 4:\n   ‚Ä¢ Consumo combustible (L/h)\n   ‚Ä¢ Flujo entrada/salida\n\nüí° RECOMENDACI√ìN:\n‚Ä¢ Combo 1: Temp. agua motor\n‚Ä¢ Combo 2: Presi√≥n aceite\n‚Ä¢ Combo 3: Temp. aceite motor\n‚Ä¢ Combo 4: Consumo combustible\n\n¬øQu√© Combo-Box necesitas configurar?',
                keywords: ['combo-box', 'combo box', 'men√∫ desplegable', 'selecci√≥n par√°metros'],
                images: ['assets/equipos/combo-box/FT-1.png', 'assets/equipos/combo-box/FT-2.png', 'assets/equipos/combo-box/FT-3.png', 'assets/equipos/combo-box/FT-4.png', 'assets/equipos/combo-box/FT-5.png']
            },
            'pantalla configuraci√≥n': {
                response: '‚öôÔ∏è PANTALLA DE CONFIGURACI√ìN:\n\nüéØ ACCESO:\nPulse el √≠cono ‚öôÔ∏è en la pantalla principal\n\nüìã ELEMENTOS PRINCIPALES:\n\nüîπ COMBO-BOX (1-4):\n   ‚Ä¢ Asignan par√°metros a pantalla principal\n   ‚Ä¢ Cada uno con opciones espec√≠ficas\n\nüîπ CONEXI√ìN WI-FI:\n   ‚Ä¢ Campo SSID (nombre red)\n   ‚Ä¢ Campo contrase√±a\n   ‚Ä¢ Permite subida autom√°tica a nube\n\nüîπ BOTONES NAVEGACI√ìN:\n   ‚Ä¢ GPS: Coordenadas y sincronizaci√≥n\n   ‚Ä¢ Logger: Intervalos de registro\n   ‚Ä¢ Bluetooth: Emparejamiento\n   ‚Ä¢ Config: Configuraci√≥n actual\n   ‚Ä¢ Inicio: Pantalla principal\n\n‚ö° PROCEDIMIENTO:\n1. Seleccione sensores en Combo-Box\n2. Configure Wi-Fi si necesario\n3. Navegue a otras pantallas\n4. Confirme cambios\n\n¬øQu√© elemento necesitas configurar?',
                keywords: ['pantalla configuraci√≥n', 'configuraci√≥n', 'config', 'configurar', 'ajustes'],
                images: ['assets/equipos/configuracion/pantalla-config-general.jpg']
            },
            'logger': {
                response: 'üìä PANTALLA LOGGER:\n\nüéØ FUNCI√ìN:\nConfigura el registro autom√°tico de datos\n\n‚öôÔ∏è PAR√ÅMETROS:\n\nüîπ LOG/SEG:\n   ‚Ä¢ Intervalo entre registros\n   ‚Ä¢ Ejemplos:\n     - 1 seg: Diagn√≥stico tiempo real\n     - 10 seg: Operaci√≥n normal\n     - 30 seg: Navegaci√≥n prolongada\n     - 60 seg: Ahorro memoria\n\nüîπ ID PANEL:\n   ‚Ä¢ C√≥digo √∫nico del equipo\n   ‚Ä¢ Esencial para identificaci√≥n en nube\n   ‚Ä¢ Formato recomendado: MOA01, MOA02...\n\nüìà FUNCIONAMIENTO:\n‚Ä¢ Los datos se guardan autom√°ticamente\n‚Ä¢ El n√∫mero de logs aumenta seg√∫n intervalo\n‚Ä¢ Se suben a la nube si hay Wi-Fi\n\n‚ö†Ô∏è IMPORTANTE:\n‚Ä¢ Intervalos muy cortos llenan memoria r√°pido\n‚Ä¢ ID Panel debe ser √∫nico por embarcaci√≥n\n‚Ä¢ Verificar que logs aumenten correctamente\n\n¬øNecesitas ayuda con alg√∫n par√°metro del Logger?',
                keywords: ['logger', 'log', 'registro', 'datos', 'intervalo', 'id panel']
            }
        };

        // ==================== COMPONENTE PRINCIPAL ====================
        function AquaAssist() {
            const [messages, setMessages] = useState([]);
            const [inputText, setInputText] = useState('');
            const [isListening, setIsListening] = useState(false);
            const [isSpeaking, setIsSpeaking] = useState(false);
            const [voiceEnabled, setVoiceEnabled] = useState(true);
            const [gpsState, setGpsState] = useState('idle');
            const [isOnline, setIsOnline] = useState(navigator.onLine);
            const [showImageGallery, setShowImageGallery] = useState(false);
            const [currentImages, setCurrentImages] = useState([]);
            const [selectedImageIndex, setSelectedImageIndex] = useState(0);
            const messagesEndRef = useRef(null);
            const recognitionRef = useRef(null);

            // Acciones r√°pidas
            const quickActions = [
                { icon: 'üè†', text: 'Pantalla Principal', query: 'pantalla principal' },
                { icon: '‚öôÔ∏è', text: 'Configuraci√≥n', query: 'configuraci√≥n' },
                { icon: 'üîß', text: 'Config. Equipos', query: 'configuraci√≥n equipos' },
                { icon: 'üìç', text: 'GPS', query: 'gps' },
                { icon: 'üö®', text: 'Alarmas', query: 'alarma' },
                { icon: 'üì±', text: 'Bluetooth', query: 'bluetooth' },
                { icon: 'üì∂', text: 'Wi-Fi', query: 'wifi' },
                { icon: '‚õΩ', text: 'Combustible', query: 'combustible' },
                { icon: 'üîß', text: 'Mantenimiento', query: 'mantenimiento' }
            ];

            // Mensaje de bienvenida
            useEffect(() => {
                const welcomeMessage = {
                    type: 'bot',
                    text: '¬°Hola! Soy Panel MQA üì°, tu asistente del Sistema de Monitoreo Marino.\n\nEstoy aqu√≠ para ayudarte con cualquier duda sobre:\n‚Ä¢ Pantalla principal y par√°metros\n‚Ä¢ Configuraci√≥n de sensores\n‚Ä¢ GPS y navegaci√≥n\n‚Ä¢ Alarmas y emergencias\n‚Ä¢ Bluetooth y Wi-Fi\n‚Ä¢ Mantenimiento preventivo\n‚Ä¢ Y mucho m√°s...\n\n¬øEn qu√© puedo ayudarte hoy?',
                    timestamp: new Date().toLocaleTimeString()
                };
                setMessages([welcomeMessage]);
            }, []);

            // Scroll autom√°tico
            useEffect(() => {
                messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
            }, [messages]);

            // Detectar estado online/offline
            useEffect(() => {
                const handleOnline = () => setIsOnline(true);
                const handleOffline = () => setIsOnline(false);

                window.addEventListener('online', handleOnline);
                window.addEventListener('offline', handleOffline);

                return () => {
                    window.removeEventListener('online', handleOnline);
                    window.removeEventListener('offline', handleOffline);
                };
            }, []);

            // Buscar respuesta en base de conocimiento
            const findResponse = (query) => {
                const lowerQuery = query.toLowerCase();
                
                // 1) Coincidencia exacta por clave (ej: 'gps', 'bluetooth', etc.)
                if (knowledgeBase[lowerQuery]) {
                    const exact = knowledgeBase[lowerQuery];
                    if (exact.images && exact.images.length > 0) {
                        setCurrentImages(exact.images);
                        setSelectedImageIndex(0);
                        setShowImageGallery(true);
                    }
                    return exact.response;
                }
                
                // 2) B√∫squeda por palabras clave
                for (const [key, value] of Object.entries(knowledgeBase)) {
                    if (value.keywords.some(keyword => lowerQuery.includes(keyword))) {
                        if (value.images && value.images.length > 0) {
                            setCurrentImages(value.images);
                            setSelectedImageIndex(0);
                            setShowImageGallery(true);
                        }
                        return value.response;
                    }
                }
                
                return 'ü§î Hmm, no tengo informaci√≥n espec√≠fica sobre eso. \n\n¬øPodr√≠as reformular tu pregunta?\n\nPuedo ayudarte con:\n‚Ä¢ Pantalla principal\n‚Ä¢ √çconos\n‚Ä¢ GPS\n‚Ä¢ Configuraci√≥n\n‚Ä¢ Alarmas\n‚Ä¢ Logger\n‚Ä¢ Bluetooth\n‚Ä¢ Wi-Fi\n‚Ä¢ Combustible\n‚Ä¢ Temperatura\n‚Ä¢ Mantenimiento\n‚Ä¢ Sensores\n\nüí° Tip: Usa los botones de acceso r√°pido para consultas comunes. üì°';
            };

            // S√≠ntesis de voz
            const speak = (text) => {
                if (!voiceEnabled || !('speechSynthesis' in window)) return;
                
                window.speechSynthesis.cancel();
                
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'es-ES';
                utterance.rate = 1.0;
                utterance.pitch = 1.2;
                utterance.volume = 0.9;
                
                const voices = window.speechSynthesis.getVoices();
                const spanishVoice = voices.find(voice => 
                    voice.lang.startsWith('es') && voice.name.includes('Google')
                ) || voices.find(voice => voice.lang.startsWith('es'));
                
                if (spanishVoice) {
                    utterance.voice = spanishVoice;
                }
                
                utterance.onstart = () => {
                    setIsSpeaking(true);
                    setGpsState('talking');
                };
                
                utterance.onend = () => {
                    setIsSpeaking(false);
                    setGpsState('idle');
                };
                
                utterance.onerror = () => {
                    setIsSpeaking(false);
                    setGpsState('idle');
                };
                
                window.speechSynthesis.speak(utterance);
            };

            // Reconocimiento de voz
            const startVoiceRecognition = () => {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                
                if (!SpeechRecognition) {
                    alert('‚ùå Tu navegador no soporta reconocimiento de voz.\n\n‚úÖ Usa Google Chrome o Microsoft Edge para esta funci√≥n.');
                    return;
                }
                
                if (recognitionRef.current) {
                    recognitionRef.current.stop();
                }
                
                const recognition = new SpeechRecognition();
                recognition.lang = 'es-ES';
                recognition.continuous = false;
                recognition.interimResults = false;
                
                recognition.onstart = () => {
                    setIsListening(true);
                    setGpsState('thinking');
                };
                
                recognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript;
                    setInputText(transcript);
                    handleSendMessage(transcript);
                };
                
                recognition.onerror = (event) => {
                    console.error('Error reconocimiento:', event.error);
                    setIsListening(false);
                    setGpsState('idle');
                    
                    if (event.error === 'no-speech') {
                        alert('‚ö†Ô∏è No detect√© ninguna voz. Intenta de nuevo.');
                    } else if (event.error === 'not-allowed') {
                        alert('‚ö†Ô∏è Permiso de micr√≥fono denegado.\n\nPor favor, permite el acceso al micr√≥fono en la configuraci√≥n de tu navegador.');
                    }
                };
                
                recognition.onend = () => {
                    setIsListening(false);
                    setGpsState('idle');
                };
                
                recognitionRef.current = recognition;
                recognition.start();
            };

            // Enviar mensaje
            const handleSendMessage = (text = inputText) => {
                if (!text.trim()) return;

                const userMessage = {
                    type: 'user',
                    text: text,
                    timestamp: new Date().toLocaleTimeString()
                };

                const response = findResponse(text);
                const botMessage = {
                    type: 'bot',
                    text: response,
                    timestamp: new Date().toLocaleTimeString()
                };

                setMessages(prev => [...prev, userMessage, botMessage]);
                setInputText('');
                speak(response);
            };

            // Acci√≥n r√°pida
            const handleQuickAction = (query) => {
                handleSendMessage(query);
            };

            // ==================== RENDER ====================
            return h('div', { className: 'min-h-screen bg-gradient-to-br from-blue-900 via-blue-700 to-cyan-600 flex flex-col' },
                // Header
                h('header', { className: 'bg-blue-950 bg-opacity-90 backdrop-blur-sm text-white p-4 shadow-lg sticky top-0 z-50' },
                    h('div', { className: 'max-w-6xl mx-auto flex items-center justify-between' },
                        h('div', { className: 'flex items-center gap-3' },
                            // Logo MQA
                             h('div', { className: 'bg-white p-2 rounded-lg shadow-md' },
                                 h('img', { 
                                     src: 'assets/logo-mqa.png', 
                                     width: '80', 
                                     height: '40', 
                                     alt: 'MQA Logo',
                                     className: 'object-contain'
                                 })
                             ),
                            h('div', { className: 'text-4xl static-glow' }, 'üì°'),
                            h('div', null,
                                h('h1', { className: 'text-2xl font-bold' }, 'üì° Panel MQA'),
                                h('p', { className: 'text-sm text-cyan-300' }, 'Sistema de Monitoreo Marino')
                            )
                        ),
                        h('div', { className: 'flex gap-2 items-center' },
                            // Logo PRO Innovate
                             h('div', { className: 'bg-white p-2 rounded-lg shadow-md' },
                                 h('img', { 
                                     src: 'assets/logo-pro-innovate.png', 
                                     width: '60', 
                                     height: '30', 
                                     alt: 'PRO Innovate Logo',
                                     className: 'object-contain'
                                 })
                             ),
                            !isOnline && h('div', { 
                                className: 'bg-yellow-500 text-white px-3 py-1 rounded-full text-xs font-semibold flex items-center gap-2'
                            },
                                h('span', null, 'üì°'),
                                h('span', null, 'Offline')
                            ),
                            h('button', {
                                onClick: () => setVoiceEnabled(!voiceEnabled),
                                className: 'p-2 bg-blue-800 rounded-lg hover:bg-blue-700 transition-colors text-xl',
                                title: voiceEnabled ? 'Desactivar voz' : 'Activar voz'
                            }, voiceEnabled ? 'üîä' : 'üîá'),
                            h('button', {
                                onClick: () => window.location.reload(),
                                className: 'p-2 bg-blue-800 rounded-lg hover:bg-blue-700 transition-colors text-xl',
                                title: 'Reiniciar'
                            }, 'üîÑ')
                        )
                    )
                ),

                // Main Content
                h('div', { className: 'flex-1 max-w-6xl w-full mx-auto p-4 flex flex-col gap-4 overflow-hidden' },
                    // GPS Avatar
                    h('div', { className: 'bg-white bg-opacity-10 backdrop-blur-md rounded-2xl p-6 text-center animate-slide-up' },
                        h('div', { className: 'relative inline-block' },
                            h('div', {
                                className: `text-8xl mb-2 transition-transform duration-500 ${
                                    gpsState === 'talking' ? 'scale-105 static-emphasis' :
                                    gpsState === 'thinking' ? 'static-highlight' :
                                    'static-glow'
                                }`
                            }, 'üì°'),
                            // Part√≠culas de agua cuando habla (reducidas)
                            isSpeaking && h('div', { className: 'absolute inset-0 pointer-events-none' },
                                ...Array.from({length: 3}, (_, i) => 
                                    h('div', {
                                        key: i,
                                        className: 'absolute text-cyan-400 opacity-60',
                                        style: {
                                            left: `${Math.random() * 100}%`,
                                            top: `${Math.random() * 100}%`,
                                            fontSize: `${Math.random() * 15 + 10}px`
                                        }
                                    }, 'üíß')
                                )
                            )
                        ),
                        h('p', { className: 'text-white text-lg font-semibold mb-2' },
                            gpsState === 'talking' ? 'üó£Ô∏è Hablando...' :
                            gpsState === 'thinking' ? 'ü§î Pensando...' :
                            'üëã Panel MQA est√° listo para ayudar'
                        ),
                        // Barras de sonido est√°ticas
                        isSpeaking && h('div', { className: 'flex justify-center gap-1 mt-2' },
                            ...Array.from({length: 3}, (_, i) => 
                                h('div', {
                                    key: i,
                                    className: 'w-2 bg-cyan-400 rounded static-glow',
                                    style: {
                                        height: `${(i % 2 === 0 ? 20 : 30)}px`
                                    }
                                })
                            )
                        )
                    ),

                    // Quick Actions
                    h('div', { className: 'grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-8 gap-2' },
                        ...quickActions.map((action, idx) =>
                            h('button', {
                                key: idx,
                                onClick: () => handleQuickAction(action.query),
                                className: 'bg-white bg-opacity-20 backdrop-blur-md hover:bg-opacity-30 text-white p-3 rounded-xl transition-all hover:scale-105 active:scale-95 flex flex-col items-center gap-1 shadow-lg'
                            },
                                h('span', { className: 'text-2xl' }, action.icon),
                                h('span', { className: 'text-xs font-medium text-center' }, action.text)
                            )
                        )
                    ),

                    // Chat Messages
                    h('div', { className: 'flex-1 bg-white bg-opacity-10 backdrop-blur-md rounded-2xl p-4 overflow-y-auto min-h-[300px] max-h-[500px]' },
                        h('div', { className: 'space-y-4' },
                            ...messages.map((msg, idx) =>
                                h('div', {
                                    key: idx,
                                    className: `flex ${msg.type === 'user' ? 'justify-end' : 'justify-start'} animate-slide-up`
                                },
                                    h('div', {
                                        className: `max-w-[80%] p-3 rounded-2xl shadow-lg ${
                                            msg.type === 'user'
                                                ? 'bg-cyan-500 text-white rounded-br-none'
                                                : 'bg-white bg-opacity-95 text-gray-800 rounded-bl-none'
                                        }`
                                    },
                                        h('p', { className: 'whitespace-pre-line' }, msg.text),
                                        h('p', { className: 'text-xs opacity-70 mt-1' }, msg.timestamp)
                                    )
                                )
                            ),
                            h('div', { ref: messagesEndRef })
                        )
                    ),

                    // Input Area
                    h('div', { className: 'bg-white bg-opacity-10 backdrop-blur-md rounded-2xl p-4' },
                        h('div', { className: 'flex gap-2' },
                            h('input', {
                                type: 'text',
                                value: inputText,
                                onChange: (e) => setInputText(e.target.value),
                                onKeyPress: (e) => e.key === 'Enter' && handleSendMessage(),
                                placeholder: 'Escribe tu pregunta aqu√≠...',
                                className: 'flex-1 p-3 rounded-xl bg-white bg-opacity-90 text-gray-800 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-cyan-400'
                            }),
                            h('button', {
                                onClick: () => handleSendMessage(),
                                disabled: !inputText.trim(),
                                className: 'px-6 py-3 bg-cyan-500 hover:bg-cyan-600 disabled:bg-gray-400 text-white rounded-xl transition-colors font-semibold'
                            }, 'üì§'),
                            h('button', {
                                onClick: startVoiceRecognition,
                                disabled: isListening,
                                className: `px-6 py-3 rounded-xl transition-colors font-semibold ${
                                    isListening 
                                        ? 'bg-red-500 animate-pulse text-white' 
                                        : 'bg-green-500 hover:bg-green-600 text-white'
                                }`
                            }, isListening ? 'üî¥' : 'üé§')
                        )
                    ),

                    // Galer√≠a de Im√°genes Modal
                    showImageGallery && h('div', {
                        className: 'fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50',
                        onClick: () => setShowImageGallery(false)
                    },
                        h('div', {
                            className: 'bg-white rounded-2xl p-6 max-w-4xl max-h-[90vh] overflow-auto',
                            onClick: (e) => e.stopPropagation()
                        },
                            h('div', { className: 'flex justify-between items-center mb-4' },
                                h('h3', { className: 'text-xl font-bold text-gray-800' }, 'üì∏ Im√°genes de Referencia'),
                                h('button', {
                                    onClick: () => setShowImageGallery(false),
                                    className: 'text-gray-500 hover:text-gray-700 text-2xl'
                                }, '‚úï')
                            ),
                            
                            // Imagen principal
                            h('div', { className: 'mb-4' },
                                h('img', {
                                    src: currentImages[selectedImageIndex],
                                    alt: `Imagen ${selectedImageIndex + 1}`,
                                    className: 'w-full max-h-96 object-contain rounded-lg border',
                                    onError: (e) => {
                                        e.target.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgdmlld0JveD0iMCAwIDQwMCAzMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI0MDAiIGhlaWdodD0iMzAwIiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik0xNzUgMTI1SDE3NVYxNzVIMjI1VjEyNUgxNzVaIiBmaWxsPSIjOUI5QkEwIi8+CjxwYXRoIGQ9Ik0yMDAgMTQwQzE5MS43IDE0MCA4NS4yIDE0MCA4NS4yIDE0MEM4NS4yIDE0MCA4NS4yIDE2MCA4NS4yIDE2MEM4NS4yIDE2MCA5MS43IDE2MCAyMDAgMTYwQzIwOC4zIDE2MCAyMTQuOCAxNjAgMjE0LjggMTYwQzIxNC44IDE2MCAyMTQuOCAxNDAgMjE0LjggMTQwQzIxNC44IDE0MCAyMDguMyAxNDAgMjAwIDE0MFoiIGZpbGw9IiM5QjlCQTAiLz4KPHR4dCB4PSIyMDAiIHk9IjE5MCIgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmaWxsPSIjNkI3Mjg0IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5JbWFnZW4gbm8gZGlzcG9uaWJsZTwvdHh0Pgo8L3N2Zz4K';
                                        e.target.alt = 'Imagen no disponible';
                                    }
                                })
                            ),
                            
                            // Navegaci√≥n de im√°genes
                            currentImages.length > 1 && h('div', { className: 'flex justify-between items-center mb-4' },
                                h('button', {
                                    onClick: () => setSelectedImageIndex(prev => prev > 0 ? prev - 1 : currentImages.length - 1),
                                    className: 'px-4 py-2 bg-cyan-500 hover:bg-cyan-600 text-white rounded-lg'
                                }, '‚Üê Anterior'),
                                h('span', { className: 'text-gray-600' }, 
                                    `${selectedImageIndex + 1} de ${currentImages.length}`
                                ),
                                h('button', {
                                    onClick: () => setSelectedImageIndex(prev => prev < currentImages.length - 1 ? prev + 1 : 0),
                                    className: 'px-4 py-2 bg-cyan-500 hover:bg-cyan-600 text-white rounded-lg'
                                }, 'Siguiente ‚Üí')
                            ),
                            
                            // Miniaturas
                            currentImages.length > 1 && h('div', { className: 'flex gap-2 overflow-x-auto' },
                                ...currentImages.map((img, index) =>
                                    h('img', {
                                        key: index,
                                        src: img,
                                        alt: `Miniatura ${index + 1}`,
                                        className: `w-16 h-16 object-cover rounded cursor-pointer border-2 ${
                                            index === selectedImageIndex ? 'border-cyan-500' : 'border-gray-300'
                                        }`,
                                        onClick: () => setSelectedImageIndex(index),
                                        onError: (e) => {
                                            e.target.style.display = 'none';
                                        }
                                    })
                                )
                            )
                        )
                    )
                )
            );
        }

        // Renderizar la aplicaci√≥n
        ReactDOM.render(h(AquaAssist), document.getElementById('app'));

        // Service Worker para PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(registration => console.log('SW registrado'))
                    .catch(error => console.log('SW fall√≥'));
            });
        }
    </script>
</body>
</html>